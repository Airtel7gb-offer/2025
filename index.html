<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Airtel 7GB Free Internet Campaign 2025</title>
    
    <!-- ‡¶´‡¶®‡ßç‡¶ü ‡¶ì ‡¶Ü‡¶á‡¶ï‡¶® -->
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- FingerprintJS (‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶ü‡¶ø-‡¶ö‡¶ø‡¶ü ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø) -->
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>

    <style>
        :root {
            --airtel-red: #E40000;
            --airtel-dark: #B30000;
            --glass-bg: rgba(255, 255, 255, 0.96);
            --text-dark: #333333;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Hind Siliguri', 'Inter', sans-serif;
            background-color: #f4f4f4; color: var(--text-dark);
            min-height: 100vh; display: flex; align-items: center; justify-content: center;
            overflow-x: hidden; position: relative;
        }
        
        /* ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
        .bg-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); z-index: -2; }
        .blob { position: absolute; filter: blur(70px); z-index: -1; opacity: 0.4; animation: float 10s infinite ease-in-out; }
        .blob-1 { width: 300px; height: 300px; background: rgba(228, 0, 0, 0.2); top: -50px; left: -50px; border-radius: 50%; }
        .blob-2 { width: 250px; height: 250px; background: rgba(255, 215, 0, 0.15); bottom: -50px; right: -50px; border-radius: 50%; animation-delay: 5s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(30px, -30px); } }

        .container { width: 92%; max-width: 400px; position: relative; z-index: 10; }
        .logo-box {
            background: white; color: var(--airtel-red); font-weight: 800; font-size: 28px;
            padding: 8px 25px; border-radius: 12px; display: inline-block;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 25px;
        }
        .card {
            background: var(--glass-bg); border: 1px solid white; border-radius: 24px;
            padding: 30px 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center;
        }
        h1 { font-size: 26px; font-weight: 700; margin-bottom: 8px; }
        p { font-size: 15px; color: #666; line-height: 1.6; margin-bottom: 25px; }

        /* ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶° */
        .input-wrapper {
            display: flex; align-items: center; background: white; border-radius: 15px;
            border: 1px solid #eee; margin-bottom: 20px; padding: 5px 15px;
        }
        .prefix { font-weight: 600; color: #333; margin-right: 10px; }
        input { border: none; width: 100%; padding: 12px 0; font-size: 18px; outline: none; font-weight: 600; }

        /* ‡¶¨‡¶æ‡¶ü‡¶® ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        .btn {
            width: 100%; padding: 15px; border: none; border-radius: 14px;
            font-size: 16px; font-weight: 600; cursor: pointer; display: flex;
            align-items: center; justify-content: center; gap: 10px; transition: 0.2s;
            color: white; margin-bottom: 10px;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, var(--airtel-red), var(--airtel-dark)); box-shadow: 0 5px 15px rgba(228,0,0,0.2); }
        
        /* ‡¶∏‡ßã‡¶∂‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶¨‡¶æ‡¶ü‡¶® */
        .social-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-fb { background: #1877F2; }
        .btn-wa { background: #25D366; grid-column: span 2; }
        .btn-tg { background: #229ED9; }
        .btn-tw { background: #1DA1F2; }
        
        .btn-claim { background: #e0e0e0; color: #999; cursor: not-allowed; margin-top: 10px; }
        .btn-claim.active {
            background: linear-gradient(135deg, #FFD700, #FFA500); color: #8B4513; cursor: pointer;
            animation: pulse 1.5s infinite;
        }

        /* ‡¶™‡ßç‡¶∞‡¶ó‡ßç‡¶∞‡ßá‡¶∏ ‡¶¨‡¶æ‡¶∞ */
        .progress-box { background: white; padding: 15px; border-radius: 16px; margin-bottom: 20px; border: 1px solid #f0f0f0; }
        .bar-bg { height: 10px; background: #eee; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .bar-fill { height: 100%; background: var(--airtel-red); width: 0%; transition: width 0.5s; }

        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* ‡¶ü‡ßã‡¶∏‡ßç‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú */
        #toast {
            visibility: hidden; min-width: 250px; background-color: #333; color: #fff;
            text-align: center; border-radius: 50px; padding: 12px; position: fixed;
            z-index: 100; left: 50%; bottom: 30px; transform: translateX(-50%); opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }
        #toast.show { visibility: visible; opacity: 1; bottom: 40px; }
    </style>
</head>
<body>

    <div class="bg-wrapper"></div>
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <div class="container">
        <div style="text-align: center;">
            <div class="logo-box">airtel</div>
        </div>

        <!-- 1. ‡¶≤‡¶ó‡¶ø‡¶® ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div id="section-login" class="card fade-in">
            <h1>‡¶´‡ßç‡¶∞‡¶ø <span style="color: var(--airtel-red);">‡ß≠ ‡¶ú‡¶ø‡¶¨‡¶ø</span> ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü</h1>
            <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡ßü‡¶æ‡¶∞‡¶ü‡ßá‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ö‡¶´‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
            <form onsubmit="handleLogin(event)">
                <div class="input-wrapper">
                    <span class="prefix">+880</span>
                    <input type="tel" id="mobileNumber" placeholder="16XXXXXXXX" maxlength="10" required>
                </div>
                <button type="submit" class="btn btn-primary">‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶® <i class="fas fa-arrow-right"></i></button>
            </form>
            <p id="login-error" style="color: red; font-size: 12px; margin-top: 10px; display: none;"></p>
        </div>

        <!-- 2. ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div id="section-dashboard" class="card hidden fade-in">
            <h2 style="font-size: 20px; margin-bottom: 5px;">‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! üéâ</h2>
            <p style="font-size: 14px; margin-bottom: 15px;">‡¶Ö‡¶´‡¶æ‡¶∞‡¶ü‡¶ø ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡¶§‡ßá <strong style="color: var(--airtel-red);">‡ß≠ ‡¶ú‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá</strong> ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>

            <!-- ‡¶™‡ßç‡¶∞‡¶ó‡ßç‡¶∞‡ßá‡¶∏ -->
            <div class="progress-box">
                <div style="display: flex; justify-content: space-between; font-size: 13px; font-weight: 700; margin-bottom: 5px;">
                    <span>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</span>
                    <span id="progress-text" style="color: var(--airtel-red);">Loading...</span>
                </div>
                <div class="bar-bg"><div id="progress-fill" class="bar-fill"></div></div>
                <p id="status-msg" style="font-size: 12px; margin: 0; color: #666;">‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶¨‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®...</p>
            </div>

            <!-- ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡¶∏ -->
            <button onclick="share('wa')" class="btn btn-wa"><i class="fab fa-whatsapp"></i> ‡¶π‡ßã‡ßü‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <div class="social-grid">
                <button onclick="share('fb')" class="btn btn-fb"><i class="fab fa-facebook-f"></i> ‡¶´‡ßá‡¶á‡¶∏‡¶¨‡ßÅ‡¶ï</button>
                <button onclick="share('tg')" class="btn btn-tg"><i class="fab fa-telegram-plane"></i> ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</button>
                <button onclick="share('tw')" class="btn btn-tw"><i class="fab fa-twitter"></i> ‡¶ü‡ßÅ‡¶á‡¶ü‡¶æ‡¶∞</button>
                <button onclick="copyLink()" class="btn" style="background: #333; grid-column: span 2;"><i class="fas fa-link"></i> ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>

            <button id="btn-claim" onclick="claimOffer()" class="btn btn-claim" disabled>
                <i class="fas fa-gift"></i> ‡ß≠ ‡¶ú‡¶ø‡¶¨‡¶ø ‡¶ï‡ßç‡¶≤‡ßá‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>

        <!-- 3. ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div id="section-success" class="card hidden fade-in">
            <div style="width: 80px; height: 80px; background: #e8f5e9; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto;">
                <i class="fas fa-check" style="color: #2e7d32; font-size: 40px;"></i>
            </div>
            <h1 style="color: #2e7d32; font-size: 24px;">‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!</h1>
            <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ ‡ß©‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡ß≠ ‡¶ú‡¶ø‡¶¨‡¶ø ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>
            <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 20px; background: #333;">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="toast">‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!</div>
    <!-- Hidden link holder for copy function -->
    <input type="text" id="hidden-ref-link" style="position: absolute; left: -9999px;">

    <script>
        // ==========================================
        // ‚öôÔ∏è ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ (SUPABASE & ADS)
        // ==========================================
        const SUPABASE_URL = 'https://xnlkbayierhmxztshxqk.supabase.co'; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ URL ‡¶¶‡¶ø‡¶®
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhubGtiYXlpZXJobXh6dHNoeHFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NzEyNjAsImV4cCI6MjA4MDM0NzI2MH0.epSeAUuYZ9JEOFy_GGoeJsdeFgm9BMOagaAka5NN7-I'; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Anon Key ‡¶¶‡¶ø‡¶®
        
        const MONETAG_LINK = "https://otieu.com/4/10252788"; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡¶ø‡¶Ç‡¶ï
        const TARGET_REFERRALS = 7;

        // Supabase ‡¶è‡¶¨‡¶Ç Fingerprint ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®
        const { createClient } = supabase;
        const _db = createClient(SUPABASE_URL, SUPABASE_KEY);
        let fpPromise = FingerprintJS.load();
        
        let currentUserPhone = null;
        let deviceID = null;

        // --- ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ---
        window.onload = async () => {
            // ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶ì‡ßü‡¶æ
            const fp = await fpPromise;
            const result = await fp.get();
            deviceID = result.visitorId;
            console.log("Device ID:", deviceID);

            // ‡¶Ü‡¶ó‡ßá ‡¶≤‡¶ó‡¶ø‡¶® ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°
            const savedPhone = localStorage.getItem('airtel_user_phone');
            if(savedPhone) {
                await fetchUserData(savedPhone);
            }
        };

        // --- ‡ßß. ‡¶≤‡¶ó‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶ü‡¶ø-‡¶ö‡¶ø‡¶ü ‡¶ö‡ßá‡¶ï‡¶ø‡¶Ç ---
        async function handleLogin(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const errorMsg = document.getElementById('login-error');
            const originalText = btn.innerHTML;
            
            let phone = document.getElementById('mobileNumber').value.replace(/\D/g,'');
            if(phone.length !== 10) { showToast("‡¶∏‡¶†‡¶ø‡¶ï ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®"); return; }
            phone = "01" + phone.substring(phone.length - 8);

            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            btn.disabled = true;
            errorMsg.style.display = 'none';

            try {
                // ‡ßß. ‡¶Ü‡¶á‡¶™‡¶ø ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏ ‡¶®‡ßá‡¶ì‡ßü‡¶æ
                const ipRes = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipRes.json();
                const userIP = ipData.ip;

                // ‡ß®. ‡¶ö‡ßá‡¶ï: ‡¶è‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶Ü‡¶ó‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ? (Strict Anti-Cheat)
                // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶¶‡ßá‡¶ñ‡¶ø ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ
                let { data: userByPhone, error: phoneError } = await _db.from('users').select('*').eq('phone_number', phone).single();
                
                // ‡¶ö‡ßá‡¶ï: ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶®‡ßá‡¶á, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ (‡¶Ö‡¶∞‡ßç‡¶•‡¶æ‡ßé ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßã‡¶≤‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶õ‡ßá ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶¶‡¶ø‡ßü‡ßá)
                let { data: userByDevice, error: deviceError } = await _db.from('users').select('*').eq('device_id', deviceID).single();

                if (!userByPhone && userByDevice) {
                    throw new Error("‡¶è‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶Ü‡¶õ‡ßá‡•§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§");
                }

                // ‡ß©. ‡¶Ø‡¶¶‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßã
                if (!userByPhone) {
                    const { data: newUser, error: insertError } = await _db.from('users').insert([
                        { 
                            phone_number: phone, 
                            device_id: deviceID, 
                            ip_address: userIP 
                        }
                    ]).select();
                    
                    if(insertError) throw insertError;

                    // ‡ß™. ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ
                    const urlParams = new URLSearchParams(window.location.search);
                    const referrerPhone = urlParams.get('ref');

                    if(referrerPhone && referrerPhone !== phone) {
                        // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤‡ßá ‡¶á‡¶®‡¶∏‡¶æ‡¶∞‡ßç‡¶ü (‡¶ü‡ßç‡¶∞‡¶ø‡¶ó‡¶æ‡¶∞ ‡¶Ö‡¶ü‡ßã ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶æ‡ßú‡¶æ‡¶¨‡ßá)
                        await _db.from('referrals').insert({
                            referrer_phone: referrerPhone,
                            referee_phone: phone,
                            referee_device_id: deviceID // ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶§‡ßá ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶® ‡¶π‡¶¨‡ßá
                        });
                    }
                } else {
                    // ‡¶Ø‡¶¶‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶•‡¶æ‡¶ï‡ßá, ‡¶è‡¶¨‡¶Ç ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≠‡¶ø‡¶®‡ßç‡¶® ‡¶π‡ßü (‡¶ö‡¶ø‡¶ü‡¶ø‡¶Ç ‡¶™‡ßç‡¶∞‡ßã‡¶ü‡ßá‡¶ï‡¶∂‡¶®)
                    if(userByPhone.device_id !== deviceID) {
                        // ‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤: ‡¶≤‡¶ó‡¶ø‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶ü‡¶ï‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø
                        // ‡¶Ü‡¶™‡¶æ‡¶§‡¶§ ‡¶≤‡¶ó‡¶ø‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶¶‡¶ø‡¶ö‡ßç‡¶õ‡¶ø
                    }
                }

                // ‡¶∏‡¶´‡¶≤ ‡¶≤‡¶ó‡¶ø‡¶®
                localStorage.setItem('airtel_user_phone', phone);
                await fetchUserData(phone);

            } catch (err) {
                console.error(err);
                errorMsg.innerText = err.message || "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®";
                errorMsg.style.display = 'block';
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // --- ‡ß®. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ---
        async function fetchUserData(phone) {
            currentUserPhone = phone;
            showSection('section-dashboard');
            
            // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ
            const baseUrl = window.location.href.split('?')[0];
            const refLink = `${baseUrl}?ref=${phone}`;
            document.getElementById('hidden-ref-link').value = refLink;

            // ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ
            const { data, error } = await _db.from('users').select('referral_count, has_claimed').eq('phone_number', phone).single();
            
            if(data) {
                updateUI(data.referral_count);
                if(data.has_claimed) {
                    const btn = document.getElementById('btn-claim');
                    btn.innerHTML = '<i class="fas fa-check"></i> ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®';
                    btn.disabled = true;
                }
            }
        }

        function updateUI(count) {
            const percent = Math.min((count / TARGET_REFERRALS) * 100, 100);
            document.getElementById('progress-fill').style.width = `${percent}%`;
            document.getElementById('progress-text').innerText = `${count}/${TARGET_REFERRALS}`;
            
            const btn = document.getElementById('btn-claim');
            const msg = document.getElementById('status-msg');

            if(count >= TARGET_REFERRALS) {
                btn.disabled = false;
                btn.classList.add('active');
                btn.innerHTML = '<i class="fas fa-unlock"></i> ‡¶Ö‡¶´‡¶æ‡¶∞‡¶ü‡¶ø ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®';
                msg.innerHTML = '<span style="color:#2e7d32; font-weight:bold;">‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡ßü‡ßá‡¶õ‡ßá!</span>';
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            } else {
                const left = TARGET_REFERRALS - count;
                msg.innerText = `‡¶Ü‡¶∞ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ${left} ‡¶ú‡¶®‡¶ï‡ßá ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶π‡¶¨‡ßá‡•§`;
            }
        }

        // --- ‡ß©. ‡¶∂‡ßá‡ßü‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ---
        // --- ‡ß©. ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶∂‡ßá‡ßü‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ (Facebook App Fix) ---
        function share(platform) {
            const link = document.getElementById('hidden-ref-link').value;
            // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®
            const text = "üéâ ‡¶è‡ßü‡¶æ‡¶∞‡¶ü‡ßá‡¶≤ ‡¶¶‡¶ø‡¶ö‡ßç‡¶õ‡ßá ‡¶´‡ßç‡¶∞‡¶ø ‡ß≠ ‡¶ú‡¶ø‡¶¨‡¶ø ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü! ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡ß©‡ß¶ ‡¶¶‡¶ø‡¶®‡•§ ‡¶è‡¶ñ‡¶®‡¶á ‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶®‡¶ø‡¶®: ";
            
            const fullUrl = encodeURIComponent(link);
            const fullText = encodeURIComponent(text);

            // ‡ßß. ‡¶´‡ßá‡¶á‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶™‡ßá‡¶∂‡¶æ‡¶≤ ‡¶≤‡¶ú‡¶ø‡¶ï (App vs Browser)
            if(platform === 'fb') {
                const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

                if (isMobile) {
                    // ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá ‡¶π‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá
                    // fb://facewebmodal/f?href= ‡¶è‡¶á ‡¶∏‡ßç‡¶ï‡¶ø‡¶Æ‡¶ü‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡¶æ‡¶≤ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ü‡ßç‡¶∞‡¶ø‡¶ó‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡ßá
                    const appUrl = `fb://facewebmodal/f?href=${fullUrl}`;
                    const webUrl = `https://www.facebook.com/sharer/sharer.php?u=${fullUrl}`;

                    // ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡ßß: ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
                    window.location.href = appUrl;

                    // ‡¶´‡¶≤‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï: ‡¶Ø‡¶¶‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡ß´‡ß¶‡ß¶ms ‡¶™‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶®‡¶ø‡¶¨‡ßá
                    setTimeout(function() {
                        window.location.href = webUrl;
                    }, 500);
                    return; 
                } else {
                    // ‡¶™‡¶ø‡¶∏‡¶ø ‡¶π‡¶≤‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá
                    window.open(`https://www.facebook.com/sharer/sharer.php?u=${fullUrl}`, '_blank');
                    return;
                }
            }

            // ‡ß®. ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ (‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á)
            let shareUrl = "";
            if(platform === 'wa') {
                shareUrl = `https://wa.me/?text=${fullText}%20${fullUrl}`;
            } else if(platform === 'tg') {
                shareUrl = `https://t.me/share/url?url=${fullUrl}&text=${fullText}`;
            } else if(platform === 'tw') {
                shareUrl = `https://twitter.com/intent/tweet?url=${fullUrl}&text=${fullText}`;
            }

            // ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
            if(shareUrl) {
                window.open(shareUrl, '_blank');
            }
        }

        function copyLink() {
            const link = document.getElementById('hidden-ref-link').value;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(link).then(() => showToast("‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"));
            } else {
                const input = document.getElementById('hidden-ref-link');
                input.style.display = 'block';
                input.style.left = '0';
                input.select();
                document.execCommand('copy');
                input.style.left = '-9999px';
                showToast("‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            }
        }

        // --- ‡ß™. ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶≤‡¶ú‡¶ø‡¶ï ---
        async function claimOffer() {
            const btn = document.getElementById('btn-claim');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç...';
            
            // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            await _db.from('users').update({ has_claimed: true }).eq('phone_number', currentUserPhone);

            // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ì‡¶™‡ßá‡¶®
            window.open(MONETAG_LINK, '_blank');

            // ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú
            setTimeout(() => {
                showSection('section-success');
                confetti({ particleCount: 200, spread: 150 });
                localStorage.removeItem('airtel_user_phone'); // ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
            }, 5000);
        }

        // ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø
        function showSection(id) {
            document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }
        function showToast(msg) {
            const x = document.getElementById("toast");
            x.innerText = msg; x.className = "show";
            setTimeout(() => { x.className = x.className.replace("show", ""); }, 3000);
        }
    </script>
</body>
</html>
